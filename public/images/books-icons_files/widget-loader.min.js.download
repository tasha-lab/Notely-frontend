/* Widget Template v1.0.0 | 2025-03-10T15:15:09.199Z */
(new class{constructor(){this.baseUrl="https://widget-builder.icons8.com/templates",this.apiUrl="https://icons8-tools.icons8.com/api/widgets",this.analyticsUrl="https://widget-builder.icons8.com/templates/v1/analytics.js"}log(t,e="info",a=null){}getTemplateUrl(t){return`${this.baseUrl}/v1/${t}-template.js`}loadScript(t){return new Promise(((e,a)=>{const i=document.createElement("script");i.src=t,i.onload=e,i.onerror=()=>a(new Error("Failed to load script: "+t)),document.head.appendChild(i)}))}getCookie(t){const e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):null}collectTargetingData(){if(!this.isNewNuxt())return[];try{const t=window.__NUXT__.pinia["auth-v3"],e=t?.user,a=[];e?.email&&a.push({type:"Email",value:e.email});const i=this.getCookie("i8widget");i&&a.push({type:"ClosedWidget",widgetId:i});const o=this.getCookie("i8-referral-code");o&&a.push({type:"Referrer",value:o});const s=e?.loaded&&!e.isGuest;return a.push({type:"User Status",isLoggedIn:String(s),isPaid:s?String(!!e.isPaid):"false"}),s&&e.allowances&&e.allowances.length>0&&e.allowances.forEach((t=>{a.push({type:"Allowance",resource:t.resource,hasAccess:!0,usagesLeft:t.usagesLeft||0,isUnlimited:t.isUnlimited||!1})})),a.push({type:"URL",fullUrl:window.location.href,path:window.location.pathname,domain:window.location.hostname}),a}catch(t){return console.error("Error collecting targeting data:",t),[]}}isNewNuxt(){return!!window.__NUXT__&&!!window.__NUXT__.pinia}async checkTargeting(){try{const t=this.collectTargetingData(),e=await fetch(`${this.apiUrl}/check-targeting`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetingData:t})});if(!e.ok)throw new Error("Failed to check targeting");const a=await e.json();return a.canShow&&a.data?a.data:(this.log("No matching widget found"),null)}catch(t){return this.log(t.message,"error"),null}}async init(){try{this.log("Initializing widget loader");try{await this.loadScript(this.analyticsUrl),this.log("Analytics loaded successfully","success")}catch(t){this.log("Failed to load analytics","error",t)}const t=await this.checkTargeting();if(!t)return void this.log("No widget to show");this.log("Loading template:","info",t.template);const e=this.getTemplateUrl(t.template);if(await this.loadScript(e),this.log("Template loaded successfully"),"function"!=typeof window.initWidget)throw new Error("Widget initialization function not found");{const e={id:t.id,title:t.parameters.translations[t.parameters.defaultLocale].headerText,subtitle:t.parameters.translations[t.parameters.defaultLocale].subheaderText,buttonName:t.parameters.translations[t.parameters.defaultLocale].buttonText,buttonLink:t.parameters.translations[t.parameters.defaultLocale].buttonLink,imageBg:t.parameters.translations[t.parameters.defaultLocale].backgroundUrl,icon:t.parameters.translations[t.parameters.defaultLocale].imageUrl,modalBackground:t.styles.modalBackground,buttonBackground:t.styles.buttonColor,titleColor:t.styles.headerColor,subTitleColor:t.styles.subheaderColor,buttonTitleColor:t.styles.buttonTitleColor};window.initWidget(e),this.log("Widget initialized","success",e)}}catch(t){this.log(t.message,"error")}}}).init();